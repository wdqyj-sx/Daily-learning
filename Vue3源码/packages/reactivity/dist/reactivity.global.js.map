{
  "version": 3,
  "sources": ["../src/index.ts", "../../shared/src/index.ts", "../src/effect.ts", "../src/baseHandler.ts", "../src/reactive.ts"],
  "sourcesContent": ["export {reactive} from \"./reactive\"\r\nexport {effect} from \"./effect\"", "export const isObject = (value)=>{\r\n    return typeof value === 'object'&& value !==null\r\n}", "export let activeEffect = undefined\r\n\r\n\r\nfunction cleanEffect(effect){\r\n    let deps = effect.deps\r\n    for(let i = 0;i<deps.length;++i){\r\n        deps[i].delete(effect)\r\n    }\r\n    effect.deps.length = 0\r\n}\r\n\r\nexport class ReactiveEffect{\r\n    public active = true\r\n    public parent = null\r\n    public deps = []\r\n    constructor(public fn,public scheduler){\r\n    }\r\n    run(){\r\n        //\u4F9D\u8D56\u6536\u96C6\uFF0C\u8BA9\u5C5E\u6027\u548Ceffect\u4EA7\u751F\u5173\u8054\r\n        //\u5982\u679C\u6CA1\u6709\u6FC0\u6D3B\uFF0C\u5219\u4E0D\u8FDB\u884C\u4F9D\u8D56\u6536\u96C6\r\n        if(!this.active){\r\n            return this.fn()\r\n        }else {\r\n           try{\r\n               //\u8BA9activeEffect\u6307\u5411\u5F53\u524Deffect\uFF0C\r\n                this.parent = activeEffect\r\n                activeEffect = this\r\n                cleanEffect(this)\r\n                //\u89E6\u53D1react\u4E2D\u7684get\u6216set\r\n                return this.fn()\r\n           }\r\n           finally{\r\n                activeEffect = this.parent\r\n                this.parent = null;\r\n           }\r\n        }\r\n    }\r\n    stop(){\r\n        if(this.active){\r\n            this.active = false\r\n        }\r\n        cleanEffect(this)\r\n    }\r\n\r\n}\r\n\r\nconst targetMap = new WeakMap()\r\n//\u8FDB\u884C\u4F9D\u8D56\u6536\u96C6\r\nexport function track(target,key){\r\n    //\u4FDD\u8BC1\u5728effect\u4E2D\u6267\u884C\r\n    if(activeEffect){\r\n        let depsMap = targetMap.get(target)\r\n        if(!depsMap){\r\n           targetMap.set(target,(depsMap = new Map()))\r\n        }\r\n        let deps = depsMap.get(key)\r\n        if(!deps){\r\n            depsMap.set(key,(deps = new Set()))\r\n        }\r\n        trackEffects(deps)\r\n       \r\n    }\r\n}\r\nexport function trackEffects(deps){\r\n   let shouldTrack = !deps.has(activeEffect)\r\n   if(shouldTrack){\r\n    deps.add(activeEffect)\r\n    activeEffect.deps.push(deps)\r\n   }\r\n    \r\n}\r\n\r\nexport function trigger(target,key,value){\r\n    let depsMap = targetMap.get(target)\r\n    //\u8BE5\u5C5E\u6027\u4E0D\u4F9D\u8D56\u4EFB\u4F55effect\r\n    if(!depsMap){\r\n        return \r\n    }\r\n    let effects = depsMap.get(key)\r\n    triggerEffects(effects)\r\n}\r\n\r\nexport function triggerEffects(effects) {\r\n   \r\n    if(effects){\r\n        effects = new Set(effects)\r\n        effects.forEach(effect =>{\r\n            if(effect !== activeEffect){\r\n                if(effect.scheduler){\r\n                    effect.scheduler()\r\n                }else{\r\n                    effect.run()\r\n                }\r\n            \r\n\r\n            }\r\n        })\r\n    }\r\n}\r\n\r\nexport function effect(fn,options={} as any){\r\n    const _effect = new ReactiveEffect(fn,options.scheduler)\r\n    _effect.run()\r\n    let runner = _effect.run.bind(_effect)\r\n    runner.effect = _effect\r\n    return runner\r\n}", "import { isObject } from \"@vue/shared\"\r\nimport {reactive} from \"./reactive\"\r\nimport { track,trigger } from \"./effect\"\r\n\r\nexport const enum ReactiveFlags {\r\n    IS_REACTIVE = '__v_isReactive'\r\n}\r\nexport {track} from \"./effect\"\r\n\r\nexport const baseHandler = {\r\n    get(target,key,receiver){\r\n        if(key === ReactiveFlags.IS_REACTIVE){\r\n            return true\r\n        }\r\n       track(target,key)\r\n        \r\n        let res = Reflect.get(target,key,receiver)\r\n        if(isObject(res)){\r\n            return reactive(res)\r\n        }\r\n        return res\r\n    },\r\n    set(target,key,value,receiver){\r\n       let oldValue = target[key]\r\n       if(oldValue!== value){\r\n        \r\n        let result  = Reflect.set(target,key,value,receiver)\r\n        //\u5BF9\u6570\u636E\u8FDB\u884C\u66F4\u65B0\r\n        trigger(target,key,value)\r\n        return result\r\n       }\r\n       \r\n    }\r\n}", "import {isObject} from \"@vue/shared\"\r\nimport {ReactiveFlags,baseHandler} from \"./baseHandler\"\r\n\r\nconst reactiveMap = new WeakMap()\r\n\r\nexport function reactive(target){\r\n    //\u4F20\u5165\u7684\u503C\u9700\u8981\u662F\u4E00\u4E2A\u5BF9\u8C61\uFF0C\u5982\u679C\u4E0D\u662F\uFF0C\u5219\u4E0D\u9700\u8981\u8FDB\u884C\u7ED1\u5B9A\r\n    if(!isObject(target)){\r\n        return target\r\n    }\r\n    const existing = reactiveMap.get(target)\r\n    if(existing){\r\n        return existing\r\n    }\r\n    if(target[ReactiveFlags.IS_REACTIVE]){\r\n        return target\r\n    }\r\n    //\u5B9E\u73B0\u6700\u521D\u7684proxy\r\n    const proxy = new Proxy(target,baseHandler)\r\n    reactiveMap.set(target,proxy)\r\n    return proxy\r\n}\r\n\r\n"],
  "mappings": "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",
  "names": []
}
